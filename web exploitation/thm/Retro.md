# Retro 

TryHackMe room bağlantı adresi: https://tryhackme.com/room/retro 

Wordpress zafiyetleri, RDP port  Windows sunucularda shell alma ve yerel yetki yükseltme gibi konularını içerir. 

## Enumeration 

Hedef ip adresi ile ilk olarak nmap taraması başlatalım. Açık portlar ve çalışan servisler hakkında bilgi toplamak saldırı yüzeyimizi belirlememizi sağlayacaktır.

![](../../pics/Pasted%20image%2020231108203738.png)

Tarama sonucuna göre 80 ve 3389 portu açık olarak görülmektedir.  80 http portu Microsoft IIS sunucusu çalışmaktadır. 3389 portu ise Windows işletim sistemlerinde uzaktan erişim olarak kullanılır.

Web uygulama ekranında yapılandırılmamış IIS servis sayfası bulunuyor.

![](../../pics/Pasted%20image%2020231108215305.png)

Dizin taraması ile bilinmeyen var olan dizinleri keşfedebiliriz. Bunun için birçok araç bulunmaktadır. En çok yaygın kullanılanların arasında gobuster, ffuf, wfuzz ve feroxbuster araçları yer alır.

> `feroxbuster -u http://TARGET_IP/ -s 200 301 302 403` 

komutunu kullanarak dizin listeleme işlemini gerçekleştirdim. Feroxbuster, recursive olarak fuzzing yapar yani bulduğu her yeni dizin için de bir tarama gerçekleştirmektedir.

![](../../pics/Pasted%20image%2020231108221731.png)

/retro dizinini keşfettik. Bu uygulama içerisinde de Wordpress çalıştığını anlayabiliriz.

![](../../pics/Pasted%20image%2020231108222119.png)

Uygulama kaynak kodlarını incelediğim zaman Wordpress sürüm bilgisine ulaşabiliyorum. Eski bir sürüm olan 5.2.1 içerisinde tespit edilen zafiyet ve exploitleri için araştırma yapabilirim.

![](../../pics/Pasted%20image%2020231108223322.png)

Wordpress wp-json dosyası kısaca kullanılan dizinleri, endpointleri listeleyen json dosyasıdır.

![](../../pics/Pasted%20image%2020231108231404.png)

Var olan kullanıcıları /wp-json/wp/v2/users ile listeleyebiliriz. Tüm bunlara erişimimizin olması bir güvenlik açığı oluşturuyor aslında.

![](../../pics/Pasted%20image%2020231108230405.png)

xml-rpc.php erişilebilir durumda. Bu sunucu credential brute forcing, port scanning gibi saldırıların gerçekleşmesini sağlaybilir.

![](../../pics/Pasted%20image%2020231108230641.png)

Bulduğumuz assetleri not alıp uygulamayı incelemeye geri dönebiliriz. Bu aşamada tespit edilen her bir bilgi saldırı vektörü olarak kullanılabilir.

![](../../pics/Pasted%20image%2020231108231454.png)

Sayfanın en alt kısmında wordpress giriş sayfasına yönlendiren bir bağlantı adresi bulunuyor. Burada hem brute-force yapılabiliyor hem de wade isimli kullanıcının var olduğu bildirilmektedir.

![](../../pics/Pasted%20image%2020231108231553.png)

Uygulamada paylaşılan gönderilerde yorum yapılabiliyor ve arama bölümü mevcut. Bu girdi alanlarında SQLi veya XSS payloadları denedim ancak sonuç alamadım. 

Wade isimli yazar kendine bir not bırakmış olduğunu uygulamayı karıştırırken bulabiliriz.

![](../../pics/Pasted%20image%2020231108231910.png)

## Wordpress Panel Exploitation 

Verilen kelimeyi /wp-login.php sayfasında giriş bilgilerine girdiğim zaman wordpress paneline wade kullanıcısı olarak giriş yaptık. Eğer burada parolayı bulamasaydık, rockyou.txt wordlist ile bruteforce yaparak, giriş bilgilerini elde etme olasılığımız var.

![](../../pics/Pasted%20image%2020231108232543.png)

Burada kullanılan eklentileri ve versiyonları görebiliriz. Kullanılan sürümlerde hangi zafiyetler ortaya çıkmış ve hangilerini kullanabiliriz araştırma yapabiliriz. Bir şekilde benim hedef makineye erişim sağlamam gerekiyor. RCE wordpress gibi anahtar kelimelerle araştırma yaptım. Aslında wordpress paneline eriştikten sonraki saldırı vektörleri neler olabilir bu tür soruları yanıtlamamız gerekiyor.

Wordpress ile reverse shell almanın birçok yolu var. İlk metod olarak, panel içerisinde php tema kodları mevcut. Bunları düzenleyip shell alınabilir mi kontrol edilebilir. Diğer bir yöntem zafiyetli bir plugin yüklemek olabilir. Sonrasında exploit kodunu çalıştırarak hedef makineye erişim sağlayabiliriz. 

Ben tema editörü kullanarak reverse shell almaya çalışacağım.

![](../../pics/Pasted%20image%2020231108235140.png)

Reverse shell payloadı için çevrim içi kullanılan revshells isimli aracı kullanacağım. Hedef işletim sistemi Windows, PHP programlama dilinde reverse shell payloadı gerekmektedir.

![](../../pics/Pasted%20image%2020231108235814.png)

IP ve port numarasını girdikten sonra php payloadı tema editöre ekleyelim ve dosyayı güncelleyip, erişmeye çalışalım.

![](../../pics/Pasted%20image%2020231109000141.png)

## Windows Post-Exploitation

iis appool\retro kullanıcısı izni çok düşük. user.txt ve root.txt dosyalarını okuyamıyor.

![](../../pics/Pasted%20image%2020231109001103.png)

Bu aşamadan sonra metasploit aracını kullanarak meterpreter shell almayı deneyebiliriz veya sistem hakkında bilgi toplayarak öncesinde exploit edilen bir zafiyetin varlığını araştırabiliriz. 

![](../../pics/Pasted%20image%2020231109001523.png)

Bir diğer saldırı yönteminde is nmap taramasında tespit edilen rdp portunu kullanarak da bu giriş bilgilerini deneyip erişim sağlanabilir.

Kısa yol olarak meterpreter oturumu aldıktan sonra yetki yükseltip flag değerlerine erişebiliriz. Bu yöntemi kullanacağım.

msfvenom ile payloadımı oluşturuyorum.

![](../../pics/Pasted%20image%2020231109001900.png)

Bu payloadı erişimim olan hedefe iletmem gerekiyor. Hedef komut satırında powershell kullanarak Invoke-WebRequest metodu ile istenilen sunucudan dosya aktarımı gerçekleştirilebilir. Bu sayede payloadımı hedefe yüklemiş oldum

![](../../pics/Pasted%20image%2020231109002545.png)

## Windows Privilege Escalation  

payload.exe'yi çalıştırmadan önce metasploit ile bir dinleyici oluşturuyorum.

![](../../pics/Pasted%20image%2020231109003017.png)

Payloadı çalıştırdıktan sonra meterpreter oturumu açıldı. Burada windows sistemlerde yetki yükseltme yöntemlerini araştırmamız gerekiyor. Basit bir yöntem olarak getsystem komutunu çalıştırdıktan sonra NT AUTHORITY\SYSTEM yani en yetkili kullanıcı olmuş olduk. getsystem komutu yetki yükseltmek için kullanılan, yerel kullanıcıya sistem yetkilerini verir.

![](../../pics/Pasted%20image%2020231109003557.png)

user.txt ve root.txt dosyalarına erişebiliyoruz.

![](../../pics/Pasted%20image%2020231109003723.png)

# Kaynaklar
* https://hackertarget.com/attacking-wordpress/
* https://www.hackingarticles.in/wordpress-reverse-shell/
* https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/wordpress
* https://book.hacktricks.xyz/network-services-pentesting/pentesting-rdp
* https://revshells.com
* https://github.com/nisforrnicholas/WordPress-Theme-Editor-Exploit
* https://docs.rapid7.com/metasploit/meterpreter-getsystem/
