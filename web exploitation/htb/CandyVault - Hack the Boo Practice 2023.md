![](../../pics/Pasted%20image%2020231027071528.png)

![](../../pics/Pasted%20image%2020231027071634.png)

find_one() fonksiyonu kullanıcının girdiği verileri veritabanında aramaktadır. Veriler form içerisinden veya json olarak alınabilir ve girilen değerlerin bir filtrelemeden geçmediğini görebiliriz.

Uygulamada kullanılan pymongo modülü versiyonunda bulunmuş herhangi bir zafiyet olup olmadığını araştırdım ancak versiyonda sıkıntı yok.

![](../../pics/Pasted%20image%2020231027081243.png)
SQL injection için kullanılan payloadlar bu durum için işe yaramıyor. Çünkü veriler json formatında vertiabanında bulunmaktadır. Mongodb SQL injection şeklinde arama yapıldığında NoSQL terimi ile karşılaşıyoruz. 

![](../../pics/Pasted%20image%2020231027082028.png)

NoSQL veritabanlarında veriler geleneksel kullanılan SQL veritabanlarına göre belirli bir formata bağlıdır. 
NoSQL injection saldırılarında iki türlü yöntem bulunur. Syntax injection, yani verilen NoSQL sorgusunun yapısını manipüle edebilmek. Operator injection ise veritabanı için kullanılan sorgu operatorleri. Örneğin, `$ne` verilen değere eşit olmayan değerleri bulur. 

Burada gönderilen isteğin içeriğini JSON formatına ayarlayıp, `$ne` operatörünü kullanarak kullanıcı girişini manipüle edebiliriz.

![](../../pics/Pasted%20image%2020231027081155.png)

Görseldeki burpsuite ile yakalanan istek düzenlendikten sonra gönderildiğinde flag değerini bulduk.

Peki bu zafiyet neden ortaya çıktı. Buna sebep olan şey nedir? Injection ile ilgili güvenlik açıklıklarının en büyük sebebi kullanıcı inputlarını filtreleme yapmadan direkt kullanmak. Burada kullanıcının girdiği veri {"$ne":"randomstring"} şeklinde. Uygulama içerisinde de kullanıcıdan alınan email ve parola değerleri filtrelenmeden kullanılmaktadır. Zafiyeti önlemek için kullanılabilen diğer bir yöntem ise, kullanılan veritabana özel operatorlerin kullanımını engellemektir. Veritabanına uygun kütüphanelerin kullanılması, birçoğu input validation, veri türlerini belirleme(type casting) ve sorgu oluşturma gibi özellikleri içerdiğinden NoSQL injection zafiyeti için önlem olarak alınabilmektedir.  

## Kaynaklar
* https://www.mehmetince.net/mongodb-ve-sql-injection-zafiyetleri/
* https://book.hacktricks.xyz/pentesting-web/nosql-injection
* https://portswigger.net/web-security/nosql-injection
